<!DOCTYPE html><html><head><meta charset=UTF-8><title>F40 Test</title><style>body{font-family:sans-serif;background:#667eea;padding:20px}.container{max-width:1200px;margin:0 auto;background:white;padding:20px;border-radius:10px}h1{text-align:center}button{padding:15px 30px;font-size:16px;margin:10px;cursor:pointer;border:none;border-radius:5px}.btn-primary{background:#667eea;color:white}.btn-secondary{background:#ccc;color:#333}#results{margin-top:20px;display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:15px}.test{padding:15px;border-radius:8px;border-left:5px solid #ccc;background:#f5f5f5}.test.pass{border-left-color:#28a745;background:#e8f5e9}.test.fail{border-left-color:#dc3545;background:#ffebee}.test h3{margin:0 0 10px 0}.test pre{background:#263238;color:#aed581;padding:10px;border-radius:5px;font-size:12px}#summary{text-align:center;padding:20px;margin-top:20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border-radius:8px;display:none}</style></head><body><div class=container><h1>Feature #40: HTTP 400 Tests</h1><p style=text-align:center>Verifying API returns HTTP 400 for invalid input</p><div style=text-align:center><button class=btn-primary onclick=runTests()>Run Tests</button><button class=btn-secondary onclick=clearResults()>Clear</button></div><div id=results></div><div id=summary><h2 id=summaryText></h2><p id=summaryPct></p></div></div><script>(function(){const API="http://localhost:8080/convert.php";const TESTS=[{name:"Missing html_blocks",body:"{}"},{name:"Empty html_blocks array",body:'{"html_blocks":[]}'},{name:"html_blocks not array",body:'{"html_blocks":"invalid"}'},{name:"Non-string in array",body:'{"html_blocks":[123]}'},{name:"Empty string",body:'{"html_blocks":[""]}'},{name:"Invalid JSON",body:"{invalid}",malformed:true},{name:"Invalid css_url type",body:'{"html_blocks":["<div>test</div>"],"css_url":123}'},{name:"Invalid css_url format",body:'{"html_blocks":["<div>test</div>"],"css_url":"not-a-url"}'},{name:"Invalid css_url scheme",body:'{"html_blocks":["   "],"css_url":"file:///etc/passwd"}'},{name:"Script tag sanitized",body:'{"html_blocks":["<script>alert(1)</script>"]}',escape:true}];function showTest(n,p,c,r){const e=document.getElementById("results");const d=document.createElement("div");d.className="test "+(p?"pass":"fail");const h3=document.createElement("h3");h3.textContent=n;d.appendChild(h3);const p1=document.createElement("p");p1.innerHTML="HTTP Status: <strong>"+c+"</strong>"+(c===400?" \u2713":" \u2717 Expected 400");d.appendChild(p1);const pre=document.createElement("pre");pre.textContent=JSON.stringify(r,null,2);d.appendChild(pre);e.appendChild(d)}async function runOne(t){try{let body=t.body;if(t.escape){body='{"html_blocks":["<script>alert(1)<\\/script>"]}'}const resp=await fetch(API,{method:"POST",headers:{"Content-Type":"application/json"},body:body});const code=resp.status;const data=await resp.json();const passed=(code===400)&&data.success===false&&data.error&&data.timestamp;showTest(t.name,passed,code,data);return passed}catch(e){showTest(t.name,false,"ERROR",{error:e.message});return false}}async function runTests(){document.getElementById("results").innerHTML="";document.getElementById("summary").style.display="none";let passed=0;for(let i=0;i<TESTS.length;i++){if(await runOne(TESTS[i]))passed++}const pct=Math.round((passed/TESTS.length)*100);const summary=document.getElementById("summary");document.getElementById("summaryText").textContent=passed+"/"+TESTS.length+" Tests Passed";document.getElementById("summaryPct").textContent=pct+"%";summary.style.display="block";if(passed===TESTS.length){summary.style.background="linear-gradient(135deg, #28a745 0%, #20c997 100%)"}}function clearResults(){document.getElementById("results").innerHTML="";document.getElementById("summary").style.display="none"}})()</script></body></html>
